# バックエンドデプロイタスク

## 目的
現在のEzDocsバックエンドアプリケーションをGoogle Cloud Platform（GCP）の Cloud Run にデプロイし、クラウド環境での稼働を実現する。

## 現状
- バックエンドアプリケーションはTypeScriptとExpress.jsで実装されている
- ローカル環境での動作確認のみが行われている
- 現時点ではヘルスチェックエンドポイント(`/health`)のみが実装されている
- Dockerファイルとdocker-compose.ymlが作成済みである
- デプロイ先のGCPプロジェクトは準備されているが、実際のデプロイは未実施

## 目標
- バックエンドアプリケーションをCloud Runにデプロイする
- デプロイしたアプリケーションが正常に動作することを確認する
- 環境変数やシークレットを適切に設定する
- デプロイの手順をドキュメント化する

## タスク一覧
- [x] GCPプロジェクトの設定確認
  - [x] 必要なAPIの有効化（Cloud Run, Container Registry, Secret Manager など）
  - [x] 適切なIAM権限の設定
- [x] 環境設定ファイルの準備
  - [x] `ezdocs.yml`ファイルの設定（productionセクションの追加・修正）
  - [x] 環境変数の設定（.env.productionファイルの作成）
- [x] ビルドとDockerイメージ作成
  - [x] TypeScriptプロジェクトのビルド
  - [x] Dockerイメージのビルド
  - [x] イメージのテスト（ローカルでの動作確認）
- [x] GCPへのデプロイ
  - [x] Artifact Registryへのイメージのプッシュ
  - [x] Cloud Runサービスの作成と設定
  - [x] 環境変数と機密情報の設定
- [x] デプロイ後の確認
  - [x] ヘルスチェックエンドポイントの動作確認
  - [x] ログの確認
  - [x] エラーハンドリングの確認
- [x] デプロイ自動化の検討
  - [x] Cloud Build設定の作成
  - [x] 継続的デプロイメントパイプラインの構築
- [x] ドキュメント作成
  - [x] デプロイ手順のドキュメント化（docs/dev.mdに追記）
  - [x] トラブルシューティングガイドの追加
  - [x] CI/CD設定手順のドキュメント化

## 注意事項
- デプロイ前にコードのレビューとテストを実施すること
- 機密情報（APIキーなど）はGCP Secret Managerに格納し、環境変数として渡すこと
- 初期デプロイはコスト効率を考慮し、最小構成で行うこと
- デプロイ後のパフォーマンスとスケーリング設定を確認すること
- エラーが発生した場合はログを確認し、適切に対応すること 

## タスク完了サマリー

**完了日**: 2025年3月3日

**成果**:
- バックエンドアプリケーションがCloud Runにデプロイされ、正常に動作していることを確認
- デプロイURL: https://ezdocs-backend-237990428649.asia-northeast1.run.app
- CI/CD環境が構築され、GitHubへのプッシュ時に自動的にビルドとデプロイが行われる設定が完了
- セットアップを自動化するスクリプト（scripts/setup.js）が拡張され、CI/CD設定も自動化可能に
- 詳細なデプロイ手順とトラブルシューティングガイドが開発者ドキュメント（docs/dev.md）に追加
