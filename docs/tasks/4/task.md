# REST API実装タスク（ドキュメントリソース）

## 目的
EzDocsシステムのバックエンドにRESTful APIを実装し、文書リソース（ドキュメント）に対するCRUD操作を提供する。クライアントアプリケーションやサードパーティシステムがEzDocsのデータにアクセスするための標準的なインターフェースを構築する。

## 現状
- バックエンドアプリケーションの基本構造は実装済み
- データベースのスキーマ設計は完了しており、マイグレーションも実装済み
- クラウドストレージの設計と実装は進行中
- REST APIエンドポイントはまだ実装されていない
- 現在はヘルスチェックエンドポイント（/health）のみが実装されている

## 目標
- RESTful設計原則に従った一貫性のあるAPIを実装する
- 文書データに対する完全なCRUD操作を提供する
- 文書リソースについてのみ実装し、関連リソース（著者、ファイル）は後続フェーズで対応
- ページネーション機能を実装する
- API入出力のバリデーションを確実に行う
- API仕様書（OpenAPI）をGoogle API Gatewayの制約を考慮して作成する
- APIのユニットテストを実装する

## タスクリスト

- [x] 1. RESTful APIの設計 - 完了：2025年3月3日
- [x] 2. RESTful APIの実装 - 完了：2025年3月3日
- [x] 3. APIエンドポイントのバリデーションとエラーハンドリング - 完了：2025年3月3日
- [x] 4. セキュリティ対策の実装 - 完了：2025年3月3日
  - [x] 4.1 入力データのサニタイズ - 完了：2025年3月3日
  - [x] 4.2 一般的なWeb攻撃に対する保護 - 完了：2025年3月3日
  - [x] 4.3 APIリクエスト検証の強化 - 完了：2025年3月3日
- [x] 5. APIドキュメントの作成 - 完了：2025年3月3日
  - [x] 5.1 OpenAPI仕様書（YAMLファイル）の作成 - 完了：2025年3月3日
  - [x] 5.2 Google API Gatewayの制約を考慮した設計 - 完了：2025年3月3日
  - [ ] 5.3 APIエンドポイント利用例の追加（MVPでスキップ - 2025年3月3日）
- [ ] 6. テスト実装
  - [ ] 6.1 単体テスト
  - [ ] 6.2 統合テスト

## 注意事項
- 認証・認可はGoogle Cloud API Gatewayに委任するため、バックエンドでの実装は不要
- OpenAPI仕様書はGoogle API Gatewayの制約を受ける可能性があるため、互換性に注意
- レート制限もAPI Gatewayで実装されるが、バックエンドでの過負荷対策は考慮する

## 保留中の機能
以下の機能は次のフェーズで実装を検討します：

1. **クエリパラメータによるフィルタリング**
   - 例: `GET /api/documents?year=2023&type=paper`

2. **著者(persons)リソースAPI**
   - `GET/POST /api/persons`
   - `GET/PUT/DELETE /api/persons/:id`
   - `GET /api/persons/:id/documents`
   - 文書への著者割り当て機能

3. **ファイルリソースAPI**
   - `GET/POST /api/files`
   - `GET/DELETE /api/files/:id`
   - `GET /api/files/:id/content`
   - 文書へのファイル割り当て機能

4. **高度なAPI機能**
   - 検索API（フルテキスト検索対応）
   - 書誌情報の自動抽出API
   - OCRテキスト抽出API
   - 引用生成API

5. **エラーハンドリングの拡張**
   - 詳細なエラーコード体系の整備
   - 多言語対応のエラーメッセージシステム
   - クライアント向けのエラーハンドリングガイドライン 