# REST API実装タスク（ドキュメントリソース）

## 目的
EzDocsシステムのバックエンドにRESTful APIを実装し、文書リソース（ドキュメント）に対するCRUD操作を提供する。クライアントアプリケーションやサードパーティシステムがEzDocsのデータにアクセスするための標準的なインターフェースを構築する。

## 現状
- バックエンドアプリケーションの基本構造は実装済み
- データベースのスキーマ設計は完了しており、マイグレーションも実装済み
- クラウドストレージの設計と実装は進行中
- REST APIエンドポイントはまだ実装されていない
- 現在はヘルスチェックエンドポイント（/health）のみが実装されている

## 目標
- RESTful設計原則に従った一貫性のあるAPIを実装する
- 文書データに対する完全なCRUD操作を提供する
- 文書リソースについてのみ実装し、関連リソース（著者、ファイル）は後続フェーズで対応
- ページネーション機能を実装する
- API入出力のバリデーションを確実に行う
- API仕様書（OpenAPI）をGoogle API Gatewayの制約を考慮して作成する
- APIのユニットテストを実装する

## タスク一覧
- [ ] 1. API設計
  - [ ] 1.1 RESTfulリソースの特定（文書リソースに集中）
  - [ ] 1.2 エンドポイント構成の設計
  - [ ] 1.3 リクエスト/レスポンスのデータ構造設計
  - [ ] 1.4 ステータスコードとエラーレスポンスの標準化
  - [ ] 1.5 ページネーション設計と実装
  - [ ] 1.6 API設計のレビューと改善

- [ ] 2. ドキュメントリソースAPIの実装
  - [ ] 2.1 `GET /api/documents` - 文書一覧取得（ページネーション対応）
  - [ ] 2.2 `GET /api/documents/:id` - 特定の文書取得
  - [ ] 2.3 `POST /api/documents` - 新規文書作成
  - [ ] 2.4 `PUT /api/documents/:id` - 文書更新
  - [ ] 2.5 `DELETE /api/documents/:id` - 文書削除

- [ ] 3. バリデーションと例外処理
  - [ ] 3.1 リクエストバリデーションミドルウェアの実装（Zod活用）
  - [ ] 3.2 グローバルエラーハンドリングの実装
  - [ ] 3.3 適切なHTTPステータスコードとエラーメッセージの設定

- [ ] 4. セキュリティ対策
  - [ ] 4.1 入力データのサニタイズ処理
  - [ ] 4.2 一般的なウェブ攻撃からの保護（XSS、SQLインジェクションなど）
  - [ ] 4.3 APIリクエスト検証の強化

- [ ] 5. APIドキュメント作成
  - [ ] 5.1 OpenAPI仕様書（`api-gw/OpenAPI.yaml`）の作成
  - [ ] 5.2 Google API Gatewayの制約を考慮した設計
  - [ ] 5.3 APIエンドポイント利用例の追加
  - [ ] 5.4 ドキュメント自動生成の設定

- [ ] 6. テスト実装
  - [ ] 6.1 ユニットテストの作成（各エンドポイント）
  - [ ] 6.2 統合テストの作成
  - [ ] 6.3 パフォーマンステストの実施

- [ ] 7. デプロイとモニタリング
  - [ ] 7.1 APIエンドポイントのデプロイ
  - [ ] 7.2 Google Cloud API Gatewayとの連携設定
  - [ ] 7.3 APIトラフィックとエラー監視の設定

## 注意事項
- 認証・認可はGoogle Cloud API Gatewayに委任するため、バックエンドでの実装は不要
- OpenAPI仕様書はGoogle API Gatewayの制約を受ける可能性があるため、互換性に注意
- レート制限もAPI Gatewayで実装されるが、バックエンドでの過負荷対策は考慮する

## 保留中の機能
以下の機能は次のフェーズで実装を検討します：

1. **クエリパラメータによるフィルタリング**
   - 例: `GET /api/documents?year=2023&type=paper`

2. **著者(persons)リソースAPI**
   - `GET/POST /api/persons`
   - `GET/PUT/DELETE /api/persons/:id`
   - `GET /api/persons/:id/documents`
   - 文書への著者割り当て機能

3. **ファイルリソースAPI**
   - `GET/POST /api/files`
   - `GET/DELETE /api/files/:id`
   - `GET /api/files/:id/content`
   - 文書へのファイル割り当て機能

4. **高度なAPI機能**
   - 検索API（フルテキスト検索対応）
   - 書誌情報の自動抽出API
   - OCRテキスト抽出API
   - 引用生成API 