swagger: '2.0'
info:
  title: EzDocs API
  description: |
    EzDocs APIは、文書リソース（論文・書籍・レポートなど）のメタデータを管理するためのRESTful APIです。
    このAPIを使用して、文書リソースの作成、取得、更新、削除などの操作を行うことができます。
  version: 1.0.0
  contact:
    name: EzDocs API Support
    email: support@ezdocs.example.com

host: api.ezdocs.example.com
basePath: /
schemes:
  - https
  - http

# サーバー環境の定義（注釈として残す）
# 本番環境: https://api.ezdocs.example.com
# ステージング環境: https://api.staging.ezdocs.example.com
# 開発環境: http://localhost:3000

tags:
  - name: documents
    description: 文書リソース操作
  - name: persons
    description: 著者リソース操作

paths:
  /api/documents:
    get:
      summary: 文書リソース一覧の取得
      description: ページネーション対応の文書リソース一覧を取得します。
      operationId: getDocuments
      tags:
        - documents
      parameters:
        - name: page
          in: query
          description: 取得するページ番号（デフォルト: 1）
          required: false
          type: integer
          default: 1
          minimum: 1
        - name: limit
          in: query
          description: 1ページあたりの件数（デフォルト: 20、最大: 100）
          required: false
          type: integer
          default: 20
          minimum: 1
          maximum: 100
      responses:
        '200':
          description: 成功レスポンス
          schema:
            $ref: '#/definitions/DocumentList'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    post:
      summary: 新規文書リソースの作成
      description: 新しい文書リソースを作成します。
      operationId: createDocument
      tags:
        - documents
      parameters:
        - name: document
          in: body
          description: 文書リソースのデータ
          required: true
          schema:
            $ref: '#/definitions/DocumentCreateRequest'
      responses:
        '201':
          description: 作成成功
          schema:
            $ref: '#/definitions/Document'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
  
  /api/documents/{id}:
    parameters:
      - name: id
        in: path
        description: 文書リソースのID（UUID形式）
        required: true
        type: string
        format: uuid
    
    get:
      summary: 特定の文書リソースの取得
      description: 指定されたIDの文書リソースを取得します。
      operationId: getDocumentById
      tags:
        - documents
      responses:
        '200':
          description: 成功レスポンス
          schema:
            $ref: '#/definitions/Document'
        '404':
          description: リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    put:
      summary: 文書リソースの更新
      description: 指定されたIDの文書リソースを更新します。
      operationId: updateDocument
      tags:
        - documents
      parameters:
        - name: document
          in: body
          description: 文書リソースの更新データ
          required: true
          schema:
            $ref: '#/definitions/DocumentUpdateRequest'
      responses:
        '200':
          description: 更新成功
          schema:
            $ref: '#/definitions/Document'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    delete:
      summary: 文書リソースの削除
      description: 指定されたIDの文書リソースを削除します。
      operationId: deleteDocument
      tags:
        - documents
      responses:
        '204':
          description: 削除成功
        '404':
          description: リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'

  /api/persons:
    get:
      summary: 著者リソース一覧の取得
      description: ページネーション対応の著者リソース一覧を取得します。
      operationId: getPersons
      tags:
        - persons
      parameters:
        - name: page
          in: query
          description: 取得するページ番号（デフォルト: 1）
          required: false
          type: integer
          default: 1
          minimum: 1
        - name: limit
          in: query
          description: 1ページあたりの件数（デフォルト: 20、最大: 100）
          required: false
          type: integer
          default: 20
          minimum: 1
          maximum: 100
        - name: q
          in: query
          description: 検索キーワード（姓名で部分一致検索）
          required: false
          type: string
      responses:
        '200':
          description: 成功レスポンス
          schema:
            $ref: '#/definitions/PersonList'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    post:
      summary: 新規著者リソースの作成
      description: 新しい著者リソースを作成します。
      operationId: createPerson
      tags:
        - persons
      parameters:
        - name: person
          in: body
          description: 著者リソースのデータ
          required: true
          schema:
            $ref: '#/definitions/PersonCreateRequest'
      responses:
        '201':
          description: 作成成功
          schema:
            $ref: '#/definitions/Person'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
  
  /api/persons/{id}:
    parameters:
      - name: id
        in: path
        description: 著者リソースのID（UUID形式）
        required: true
        type: string
        format: uuid
    
    get:
      summary: 特定の著者リソースの取得
      description: 指定されたIDの著者リソースを取得します。
      operationId: getPersonById
      tags:
        - persons
      responses:
        '200':
          description: 成功レスポンス
          schema:
            $ref: '#/definitions/Person'
        '404':
          description: リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    put:
      summary: 著者リソースの更新
      description: 指定されたIDの著者リソースを更新します。
      operationId: updatePerson
      tags:
        - persons
      parameters:
        - name: person
          in: body
          description: 著者リソースの更新データ
          required: true
          schema:
            $ref: '#/definitions/PersonUpdateRequest'
      responses:
        '200':
          description: 更新成功
          schema:
            $ref: '#/definitions/Person'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    delete:
      summary: 著者リソースの削除
      description: 指定されたIDの著者リソースを削除します。
      operationId: deletePerson
      tags:
        - persons
      responses:
        '204':
          description: 削除成功
        '404':
          description: リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'

  /api/persons/{id}/documents:
    parameters:
      - name: id
        in: path
        description: 著者リソースのID（UUID形式）
        required: true
        type: string
        format: uuid
    
    get:
      summary: 著者に関連する文書リソース一覧の取得
      description: 指定された著者に関連する文書リソースの一覧を取得します。
      operationId: getPersonDocuments
      tags:
        - persons
      parameters:
        - name: page
          in: query
          description: 取得するページ番号（デフォルト: 1）
          required: false
          type: integer
          default: 1
          minimum: 1
        - name: limit
          in: query
          description: 1ページあたりの件数（デフォルト: 20、最大: 100）
          required: false
          type: integer
          default: 20
          minimum: 1
          maximum: 100
      responses:
        '200':
          description: 成功レスポンス
          schema:
            $ref: '#/definitions/DocumentList'
        '404':
          description: 著者リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'
    
    post:
      summary: 著者と文書の関連付け
      description: 指定された著者と文書を関連付けます。
      operationId: associateDocument
      tags:
        - persons
      parameters:
        - name: documentAuthor
          in: body
          description: 文書と著者の関連付けデータ
          required: true
          schema:
            $ref: '#/definitions/DocumentAuthorRequest'
      responses:
        '201':
          description: 関連付け成功
          schema:
            $ref: '#/definitions/DocumentAuthor'
        '400':
          description: 不正なリクエスト
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: 著者または文書リソースが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'

  /api/persons/{id}/documents/{document_id}:
    parameters:
      - name: id
        in: path
        description: 著者リソースのID（UUID形式）
        required: true
        type: string
        format: uuid
      - name: document_id
        in: path
        description: 文書リソースのID（UUID形式）
        required: true
        type: string
        format: uuid
    
    delete:
      summary: 著者と文書の関連付け解除
      description: 指定された著者と文書の関連付けを解除します。
      operationId: dissociateDocument
      tags:
        - persons
      responses:
        '204':
          description: 関連付け解除成功
        '404':
          description: 著者または文書リソース、または関連付けが見つからない
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: サーバー内部エラー
          schema:
            $ref: '#/definitions/Error'

definitions:
  DocumentType:
    type: string
    enum:
      - paper
      - book
      - other
    description: |
      文書の種類:
      * `paper` - 論文（学術論文、研究レポートなど）
      * `book` - 書籍（単行本、教科書など）
      * `other` - その他の文書タイプ
  
  DocumentCreateRequest:
    type: object
    required:
      - title
    properties:
      title:
        type: string
        description: 文書のタイトル
      type:
        $ref: '#/definitions/DocumentType'
      abstract:
        type: string
        description: 論文の要約
      year:
        type: integer
        description: 出版年
      month:
        type: integer
        minimum: 1
        maximum: 12
        description: 出版月
      day:
        type: integer
        minimum: 1
        maximum: 31
        description: 出版日
      pages:
        type: string
        description: ページ範囲（例: '1-15'）
      volume:
        type: string
        description: 巻号
      issue:
        type: string
        description: 号
      source:
        type: string
        description: 出典（例: 'Journal Name'）
      publisher:
        type: string
        description: 出版社名
      language:
        type: string
        description: 言語コード（例: 'ja', 'en'）
      identifiers:
        type: string
        description: 識別子（例: DOI, ISBN）をJSON形式で格納 (例: "{\"doi\":\"10.1234/5678\",\"isbn\":\"978-4-1234-5678-9\"}")
      urls:
        type: string
        description: 関連URLをJSON形式で格納 (例: "{\"publisher\":\"https://example.com/paper\"}")
      keywords:
        type: string
        description: キーワードをJSON形式で格納 (例: "{\"keywords\":[\"人工知能\",\"機械学習\"]}")
      ai_keywords:
        type: string
        description: AIが生成したキーワードをJSON形式で格納 (例: "{\"keywords\":[\"深層学習\",\"自然言語処理\"]}")
  
  DocumentUpdateRequest:
    type: object
    properties:
      title:
        type: string
        description: 文書のタイトル
      type:
        $ref: '#/definitions/DocumentType'
      abstract:
        type: string
        description: 論文の要約
      year:
        type: integer
        description: 出版年
      month:
        type: integer
        minimum: 1
        maximum: 12
        description: 出版月
      day:
        type: integer
        minimum: 1
        maximum: 31
        description: 出版日
      pages:
        type: string
        description: ページ範囲（例: '1-15'）
      volume:
        type: string
        description: 巻号
      issue:
        type: string
        description: 号
      source:
        type: string
        description: 出典（例: 'Journal Name'）
      publisher:
        type: string
        description: 出版社名
      language:
        type: string
        description: 言語コード（例: 'ja', 'en'）
      identifiers:
        type: string
        description: 識別子（例: DOI, ISBN）をJSON形式で格納 (例: "{\"doi\":\"10.1234/5678\",\"isbn\":\"978-4-1234-5678-9\"}")
      urls:
        type: string
        description: 関連URLをJSON形式で格納 (例: "{\"publisher\":\"https://example.com/paper\"}")
      keywords:
        type: string
        description: キーワードをJSON形式で格納 (例: "{\"keywords\":[\"人工知能\",\"機械学習\"]}")
      ai_keywords:
        type: string
        description: AIが生成したキーワードをJSON形式で格納 (例: "{\"keywords\":[\"深層学習\",\"自然言語処理\"]}")
  
  Document:
    type: object
    properties:
      id:
        type: string
        format: uuid
        description: 文書のユニークID
      title:
        type: string
        description: 文書のタイトル
      type:
        $ref: '#/definitions/DocumentType'
      abstract:
        type: string
        description: 論文の要約
      ai_summary:
        type: string
        description: AIが生成した要約
      year:
        type: integer
        description: 出版年
      month:
        type: integer
        description: 出版月
      day:
        type: integer
        description: 出版日
      pages:
        type: string
        description: ページ範囲（例: '1-15'）
      volume:
        type: string
        description: 巻号
      issue:
        type: string
        description: 号
      source:
        type: string
        description: 出典（例: 'Journal Name'）
      publisher:
        type: string
        description: 出版社名
      language:
        type: string
        description: 言語コード（例: 'ja', 'en'）
      identifiers:
        type: string
        description: 識別子（例: DOI, ISBN）をJSON形式で格納
      urls:
        type: string
        description: 関連URLをJSON形式で格納
      keywords:
        type: string
        description: キーワードをJSON形式で格納
      ai_keywords:
        type: string
        description: AIが生成したキーワードをJSON形式で格納
      created_at:
        type: string
        format: date-time
        description: 作成日時
      updated_at:
        type: string
        format: date-time
        description: 更新日時
  
  DocumentSummary:
    type: object
    properties:
      id:
        type: string
        format: uuid
        description: 文書のユニークID
      title:
        type: string
        description: 文書のタイトル
      type:
        $ref: '#/definitions/DocumentType'
      year:
        type: integer
        description: 出版年
      language:
        type: string
        description: 言語コード（例: 'ja', 'en'）
      created_at:
        type: string
        format: date-time
        description: 作成日時
      updated_at:
        type: string
        format: date-time
        description: 更新日時
  
  Pagination:
    type: object
    properties:
      total:
        type: integer
        description: 全アイテム数
      page:
        type: integer
        description: 現在のページ
      limit:
        type: integer
        description: 1ページあたりの件数
      pages:
        type: integer
        description: 総ページ数
  
  DocumentList:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/DocumentSummary'
      pagination:
        $ref: '#/definitions/Pagination'
  
  Error:
    type: object
    required:
      - status
      - message
    properties:
      status:
        type: string
        description: エラー状態（常に 'error'）
        example: error
      code:
        type: string
        description: エラーコード
        example: VALIDATION_ERROR
      message:
        type: string
        description: エラーメッセージ
        example: 入力データの検証に失敗しました
      details:
        type: object
        description: エラーの詳細情報
        additionalProperties:
          type: string
  
  PersonCreateRequest:
    type: object
    required:
      - last_name
    properties:
      last_name:
        type: string
        description: 著者の姓
      first_name:
        type: string
        description: 著者の名（オプション）
  
  PersonUpdateRequest:
    type: object
    properties:
      last_name:
        type: string
        description: 著者の姓
      first_name:
        type: string
        description: 著者の名
  
  Person:
    type: object
    properties:
      id:
        type: string
        format: uuid
        description: 著者のユニークID
      last_name:
        type: string
        description: 著者の姓
      first_name:
        type: string
        description: 著者の名（null可）
      created_at:
        type: string
        format: date-time
        description: 作成日時
      updated_at:
        type: string
        format: date-time
        description: 更新日時
  
  PersonList:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/Person'
      pagination:
        $ref: '#/definitions/Pagination'
  
  DocumentAuthorRequest:
    type: object
    required:
      - document_id
      - order
    properties:
      document_id:
        type: string
        format: uuid
        description: 文書リソースのID
      order:
        type: integer
        minimum: 1
        description: 著者の順序（1から始まる整数）
  
  DocumentAuthor:
    type: object
    properties:
      document_id:
        type: string
        format: uuid
        description: 文書リソースのID
      person_id:
        type: string
        format: uuid
        description: 著者リソースのID
      order:
        type: integer
        description: 著者の順序
      document:
        $ref: '#/definitions/DocumentSummary'
      person:
        $ref: '#/definitions/Person' 